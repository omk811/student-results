<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>نظام نتائج الطلاب - الأستاذ خليل البلوشي</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- خط و أيقونات -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhaijaan+2:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    :root {
      --bg: #020617;              /* خلفية عامة */
      --bg-alt: #020617;
      --card: #020617;            /* بطاقات داكنة */
      --card-soft: #020617;
      --border-soft: #1e293b;
      --primary: #22c55e;         /* أخضر زمردي */
      --primary-soft: rgba(34, 197, 94, 0.18);
      --accent: #38bdf8;          /* أزرق سماوي مساعد */
      --danger: #f97373;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --radius-lg: 22px;
      --radius: 16px;
      --shadow: 0 18px 45px rgba(0, 0, 0, 0.7);
      --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.5);
      --transition: 0.25s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Baloo Bhaijaan 2", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(34, 197, 94, 0.12), transparent 55%),
        radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.12), transparent 55%),
        var(--bg);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px 16px 40px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 28px;
    }

    .logo {
      width: 90px;
      height: 90px;
      margin: 0 auto 12px;
      border-radius: 999px;
      background:
        conic-gradient(from 140deg, rgba(34, 197, 94, 0.15), rgba(56, 189, 248, 0.2), rgba(34, 197, 94, 0.15));
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .logo::before {
      content: "";
      position: absolute;
      inset: 3px;
      border-radius: inherit;
      background: radial-gradient(circle at 20% 0%, rgba(255, 255, 255, 0.16), transparent 55%), #020617;
    }

    .logo-icon {
      position: relative;
      z-index: 1;
      font-size: 34px;
      color: var(--primary);
    }

    header h1 {
      font-size: 30px;
      margin-bottom: 4px;
      background: linear-gradient(130deg, #22c55e, #38bdf8);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    header .subtitle {
      color: var(--text-muted);
      font-size: 17px;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.7fr);
      gap: 22px;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.12), transparent 60%), #020617;
      border-radius: var(--radius-lg);
      padding: 24px 22px 22px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(148, 163, 184, 0.12);
      position: relative;
      overflow: hidden;
    }

    .card::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.16), transparent 55%);
      opacity: 0.6;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }

    .card-title {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 20px;
      font-weight: 700;
    }

    .card-title i {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 20% 0%, rgba(34, 197, 94, 0.24), transparent 55%);
      color: var(--primary);
    }

    .card-subtitle {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .field-label {
      font-size: 15px;
      margin-bottom: 6px;
      color: var(--text-muted);
    }

    .input-wrapper {
      position: relative;
      margin-bottom: 14px;
    }

    input[type="text"] {
      width: 100%;
      padding: 14px 44px 14px 14px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.9));
      color: var(--text-main);
      font-size: 17px;
      outline: none;
      transition: border var(--transition), box-shadow var(--transition), background var(--transition), transform var(--transition);
    }

    input[type="text"]::placeholder {
      color: #64748b;
    }

    input[type="text"]:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5), 0 0 0 10px rgba(34, 197, 94, 0.08);
      background: radial-gradient(circle at top left, rgba(22, 163, 74, 0.22), rgba(15, 23, 42, 0.96));
      transform: translateY(-1px);
    }

    .input-icon {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: #64748b;
      font-size: 17px;
      pointer-events: none;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 6px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 11px 16px;
      font-family: inherit;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 7px;
      transition: transform var(--transition), box-shadow var(--transition), background var(--transition), opacity 0.18s;
      white-space: nowrap;
    }

    button i {
      font-size: 15px;
    }

    .btn-primary {
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
      color: #ecfdf5;
      box-shadow: 0 10px 25px rgba(22, 163, 74, 0.45);
      flex: 1;
      min-width: 160px;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(22, 163, 74, 0.6);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      border: 1px solid var(--border-soft);
      flex: 1;
      min-width: 160px;
    }

    .btn-secondary:hover {
      border-color: var(--primary);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.9);
    }

    .btn-print {
      background: radial-gradient(circle at top left, #22c55e, #15803d);
      color: #ecfdf5;
      min-width: 120px;
    }

    .btn-print:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(21, 128, 61, 0.7);
    }

    .btn:disabled,
    button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .quote-card {
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.2), transparent 60%), #020617;
      border-radius: var(--radius-lg);
      padding: 22px 22px 18px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .quote-card::before {
      content: "";
      position: absolute;
      width: 160px;
      height: 160px;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(34, 197, 94, 0.18), transparent 70%);
      right: -40px;
      top: -40px;
      opacity: 0.8;
    }

    .quote-card-inner {
      position: relative;
      z-index: 1;
    }

    .quote-teacher {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--primary);
    }

    .quote-text {
      font-size: 15px;
      color: var(--text-main);
    }

    .quote-text span {
      color: var(--accent);
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-muted);
      font-size: 13px;
      margin-top: 10px;
    }

    .chip i {
      font-size: 12px;
      color: var(--primary);
    }

    #status {
      margin-top: 16px;
      font-size: 14px;
    }

    .status-msg {
      border-radius: 999px;
      padding: 8px 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid transparent;
    }

    .status-ok {
      background: rgba(22, 163, 74, 0.12);
      border-color: rgba(22, 163, 74, 0.5);
      color: #bbf7d0;
    }

    .status-error {
      background: rgba(239, 68, 68, 0.12);
      border-color: rgba(248, 113, 113, 0.7);
      color: #fecaca;
    }

    .status-loading {
      background: rgba(56, 189, 248, 0.1);
      border-color: rgba(56, 189, 248, 0.7);
      color: #e0f2fe;
    }

    #result {
      margin-top: 24px;
    }

    .results-container {
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.22), transparent 55%), rgba(15, 23, 42, 0.98);
      border-radius: var(--radius-lg);
      padding: 20px 20px 18px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: var(--shadow);
    }

    .student-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 999px;
      background: linear-gradient(120deg, rgba(34, 197, 94, 0.25), rgba(15, 23, 42, 0.95));
      margin-bottom: 18px;
    }

    .student-name {
      display: none !important; /* إخفاء الاسم تماماً */
    }

    .student-total-label {
      font-size: 14px;
      color: #bbf7d0;
      text-align: right;
    }

    .student-total-value {
      font-size: 26px;
      font-weight: 700;
      color: #f9fafb;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 12px;
    }

    @media (max-width: 900px) {
      .stats-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 600px) {
      .stats-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .stat-card {
      background: rgba(15, 23, 42, 0.98);
      border-radius: 18px;
      padding: 10px 12px 12px;
      border: 1px solid rgba(148, 163, 184, 0.18);
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-sub {
      font-size: 13px;
      color: #9ca3af;
    }

    .results-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 15px;
    }

    .results-table th,
    .results-table td {
      padding: 10px 6px;
      border-bottom: 1px solid rgba(30, 41, 59, 0.9);
      text-align: center;
    }

    .results-table th {
      font-size: 14px;
      color: #cbd5f5;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 1));
    }

    .results-table tr:nth-child(even) td {
      background: rgba(15, 23, 42, 0.82);
    }

    .results-table tr:nth-child(odd) td {
      background: rgba(15, 23, 42, 0.95);
    }

    .max-score td {
      background: rgba(34, 197, 94, 0.12) !important;
      font-weight: 600;
      color: #bbf7d0;
    }

    .final-row td {
      background: rgba(56, 189, 248, 0.12) !important;
      font-weight: 600;
      color: #e0f2fe;
    }

    .grand-total-row td {
      background: rgba(34, 197, 94, 0.18) !important;
      font-weight: 700;
      color: #f9fafb;
      font-size: 16px;
    }

    .level-row td {
      background: rgba(59, 130, 246, 0.16) !important;
      font-weight: 600;
      color: #bfdbfe;
    }

    .note {
      margin-top: 10px;
      font-size: 13px;
      color: var(--text-muted);
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .note i {
      margin-top: 2px;
      color: var(--primary);
      font-size: 13px;
    }

    footer {
      margin-top: 26px;
      text-align: center;
      font-size: 13px;
      color: var(--text-muted);
    }

    .print-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-family: "Baloo Bhaijaan 2", sans-serif;
      font-size: 15px;
      direction: rtl;
    }

    .print-table th,
    .print-table td {
      border: 1px solid #0f172a;
      padding: 8px 6px;
      text-align: center;
    }

    .print-table th {
      background: #020617;
      color: #e5e7eb;
    }

    @media print {
      body * {
        visibility: hidden;
      }
      #printSection,
      #printSection * {
        visibility: visible;
      }
      #printSection {
        position: absolute;
        inset: 0;
        margin: 0;
        padding: 10px 16px;
        background: #ffffff !important;
        color: #000000 !important;
      }
      header,
      .layout,
      #result,
      #status,
      footer {
        display: none !important;
      }
      button,
      input {
        display: none !important;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-graduation-cap"></i>
        </div>
      </div>
      <h1>نظام نتائج الطلاب</h1>
      <p class="subtitle">متابعة دقيقة لدرجات الطالب في مادة اللغة العربية</p>
    </header>

    <div class="layout">
      <!-- كارت الاستعلام -->
      <section class="card">
        <div class="card-inner">
          <div class="card-header">
            <div>
              <div class="card-title">
                <i class="fas fa-magnifying-glass-chart"></i>
                <span>استعلام النتائج</span>
              </div>
              <div class="card-subtitle">أدخل رقم الطالب كما هو مسجل في النظام</div>
            </div>
          </div>

          <div class="field">
            <div class="field-label">رقم الطالب</div>
            <div class="input-wrapper">
              <input
                type="text"
                id="studentId"
                autocomplete="off"
                placeholder="مثال: 1 أو 15 أو 203"
                onkeypress="if(event.key==='Enter'){ checkResult(); }"
              />
              <span class="input-icon">
                <i class="fas fa-hashtag"></i>
              </span>
            </div>
          </div>

          <div class="btn-group">
            <button class="btn-primary" id="btnShow" onclick="checkResult()">
              <i class="fas fa-chart-line"></i>
              <span>عرض النتائج</span>
            </button>
            <button class="btn-secondary" id="btnLoad" onclick="loadData()">
              <i class="fas fa-rotate"></i>
              <span>تحديث البيانات</span>
            </button>
            <button class="btn-print" id="printBtn" style="display: none;" onclick="printTable()">
              <i class="fas fa-print"></i>
              <span>طباعة</span>
            </button>
          </div>

          <div id="status"></div>
        </div>
      </section>

      <!-- كارت العبارة التحفيزية -->
      <aside class="quote-card" id="quoteCard">
        <div class="quote-card-inner">
          <div class="quote-teacher">
            <i class="fas fa-user-tie"></i>
            <span>الأستاذ خليل البلوشي</span>
          </div>
          <div class="quote-text">
            "كل درجة تُضاف إلى رصيدك اليوم، هي <span>خطوة ثابتة</span> نحو مستقبلٍ أوسع فرصةً وأقوى أثرًا.
            تعلَّم، جرِّب، أخطئ، ثم صحِّح؛ فهكذا تُبنى شخصية متوازنة واثقة من نفسها."
          </div>
          <div class="chip">
            <i class="fas fa-lightbulb"></i>
            <span>نقيس الدرجات، لكننا نراهن على الجهد والمثابرة.</span>
          </div>
        </div>
      </aside>
    </div>

    <div id="result"></div>

    <!-- قسم الطباعة -->
    <div id="printSection" style="display: none;"></div>

    <footer>جميع الحقوق محفوظة © 2025 – نظام نتائج الطلاب – إعداد: الأستاذ خليل البلوشي</footer>
  </div>

  <script>
    let results = {};
    let currentStudentData = null;
    let loading = false;

    const GOOGLE_SHEET_URL =
      "https://docs.google.com/spreadsheets/d/1bY6sJ2CaLy7olcCpmX6V7HMuoGZIC6G9VcPWpk0eFGw/gviz/tq?tqx=out:json";

    function normalizeScore(value) {
      if (value === -1 || value === "-1") return "—";
      return value ?? 0;
    }

    function scoreForCalc(value) {
      if (value === -1 || value === "-1") return 0;
      return parseFloat(value) || 0;
    }

    function setStatus(message, type) {
      const status = document.getElementById("status");
      if (!message) {
        status.innerHTML = "";
        return;
      }
      let cls = "status-msg ";
      if (type === "ok") cls += "status-ok";
      else if (type === "error") cls += "status-error";
      else cls += "status-loading";

      const icon =
        type === "ok"
          ? '<i class="fas fa-circle-check"></i>'
          : type === "error"
          ? '<i class="fas fa-triangle-exclamation"></i>'
          : '<i class="fas fa-spinner fa-spin"></i>';

      status.innerHTML = '<div class="' + cls + '">' + icon + "<span>" + message + "</span></div>";
    }

    async function loadData() {
      if (loading) return;
      loading = true;
      setStatus("جاري تحميل بيانات الطلاب من النظام...", "loading");
      document.getElementById("btnLoad").disabled = true;

      try {
        const response = await fetch(GOOGLE_SHEET_URL);
        const text = await response.text();

        const cleaned = text
          .replace("/*O_o*/", "")
          .replace("google.visualization.Query.setResponse(", "")
          .replace(");", "");

        const data = JSON.parse(cleaned);
        const rows = data.table.rows || [];

        results = {};

        rows.forEach((row) => {
          const c = row.c;
          if (!c || !c[0] || !c[0].v) return;

          const studentId = c[0].v.toString().trim();
          if (!studentId) return;

          const name = c[1]?.v ?? "—";
          const oral = c[2]?.v ?? 0;
          const homework = c[3]?.v ?? 0;
          const listening = c[4]?.v ?? 0;
          const exam1 = c[5]?.v ?? 0;
          const exam2 = c[6]?.v ?? 0;
          const writing = c[7]?.v ?? 0;
          const final = c[9]?.v ?? 0;

          const total =
            scoreForCalc(oral) +
            scoreForCalc(homework) +
            scoreForCalc(listening) +
            scoreForCalc(exam1) +
            scoreForCalc(exam2) +
            scoreForCalc(writing);

          results[studentId] = {
            name,
            oral,
            homework,
            listening,
            exam1,
            exam2,
            writing,
            total,
            final,
          };
        });

        setStatus("تم تحديث بيانات النتائج بنجاح.", "ok");
      } catch (err) {
        console.error(err);
        setStatus("حدث خطأ أثناء تحميل البيانات. حاول مرة أخرى لاحقاً.", "error");
      } finally {
        loading = false;
        document.getElementById("btnLoad").disabled = false;
      }
    }

    function getStudentLevel(score) {
      if (score >= 90) return "ممتاز (A)";
      if (score >= 80) return "جيد جداً (B)";
      if (score >= 65) return "جيد (C)";
      if (score >= 50) return "مقبول (D)";
      return "يحتاج إلى مساعدة (F)";
    }

    function checkResult() {
      const idInput = document.getElementById("studentId");
      const id = idInput.value.trim();
      const resultDiv = document.getElementById("result");
      const printBtn = document.getElementById("printBtn");
      const quoteCard = document.getElementById("quoteCard");

      if (!id) {
        resultDiv.innerHTML = "";
        setStatus("يرجى إدخال رقم الطالب أولاً.", "error");
        printBtn.style.display = "none";
        return;
      }

      if (!results[id]) {
        resultDiv.innerHTML = "";
        setStatus("عذراً، رقم الطالب غير موجود في قاعدة البيانات.", "error");
        printBtn.style.display = "none";
        return;
      }

      setStatus("", "");
      if (quoteCard) quoteCard.style.opacity = 0.35;

      const st = results[id];
      currentStudentData = st;

      const grandTotal = scoreForCalc(st.total) + scoreForCalc(st.final);
      const level = getStudentLevel(grandTotal);

      const html =
        '<div class="results-container">' +
        '<div class="student-info">' +
        '<div class="student-name"></div>' +
        '<div style="text-align:right;">' +
        '<div class="student-total-label">المجموع الكلي</div>' +
        '<div class="student-total-value">' +
        grandTotal +
        "/100</div>" +
        "</div>" +
        "</div>" +
        '<div class="stats-grid">' +
        '<div class="stat-card">' +
        '<div class="stat-label">مجموع أعمال الطالب</div>' +
        '<div class="stat-value">' +
        normalizeScore(st.total) +
        "/60</div>" +
        '<div class="stat-sub">العرض الشفوي، الواجب، التسميع، الاختباران القصيران، التعبير</div>' +
        "</div>" +
        '<div class="stat-card">' +
        '<div class="stat-label">درجة الاختبار النهائي</div>' +
        '<div class="stat-value">' +
        normalizeScore(st.final) +
        "/40</div>" +
        '<div class="stat-sub">امتحان نهاية الفصل</div>' +
        "</div>" +
        '<div class="stat-card">' +
        '<div class="stat-label">المجموع الكلي</div>' +
        '<div class="stat-value">' +
        grandTotal +
        "/100</div>" +
        '<div class="stat-sub">أعمال + نهائي</div>' +
        "</div>" +
        '<div class="stat-card">' +
        '<div class="stat-label">مستوى الطالب</div>' +
        '<div class="stat-value">' +
        level +
        "</div>" +
        '<div class="stat-sub">للاطلاع العام لولي الأمر والطالب</div>' +
        "</div>" +
        "</div>" +
        '<table class="results-table">' +
        "<thead>" +
        "<tr>" +
        "<th>نوع التقييم</th>" +
        "<th>الدرجة الكاملة</th>" +
        "<th>درجة الطالب</th>" +
        "</tr>" +
        "</thead>" +
        "<tbody>" +
        "<tr><td>العرض الشفوي</td><td>10</td><td>" +
        normalizeScore(st.oral) +
        "</td></tr>" +
        "<tr><td>الواجب المنزلي</td><td>5</td><td>" +
        normalizeScore(st.homework) +
        "</td></tr>" +
        "<tr><td>التسميع / الاستماع</td><td>5</td><td>" +
        normalizeScore(st.listening) +
        "</td></tr>" +
        "<tr><td>الاختبار القصير الأول</td><td>15</td><td>" +
        normalizeScore(st.exam1) +
        "</td></tr>" +
        "<tr><td>الاختبار القصير الثاني</td><td>15</td><td>" +
        normalizeScore(st.exam2) +
        "</td></tr>" +
        "<tr><td>التعبير الكتابي</td><td>10</td><td>" +
        normalizeScore(st.writing) +
        "</td></tr>" +
        '<tr class="max-score"><td>مجموع أعمال الطالب</td><td>60</td><td>' +
        normalizeScore(st.total) +
        "</td></tr>" +
        '<tr class="final-row"><td>درجة الاختبار النهائي</td><td>40</td><td>' +
        normalizeScore(st.final) +
        "</td></tr>" +
        '<tr class="grand-total-row"><td>المجموع الكلي</td><td>100</td><td>' +
        grandTotal +
        "</td></tr>" +
        '<tr class="level-row"><td>مستوى الطالب</td><td colspan="2">' +
        level +
        "</td></tr>" +
        "</tbody>" +
        "</table>" +
        '<div class="note">' +
        '<i class="fas fa-circle-info"></i>' +
        '<span>ظهور الرمز "<strong>—</strong>" يعني أن التقييم لم يُسجَّل بعد في النظام، بينما "0" تعني أن الطالب حصل على صفر فعلياً في هذا الجانب.</span>' +
        "</div>" +
        "</div>";

      resultDiv.innerHTML = html;
      printBtn.style.display = "inline-flex";
    }

 function printTable() {
  if (!currentStudentData) return;

  const st = currentStudentData;
  const grandTotal = scoreForCalc(st.total) + scoreForCalc(st.final);
  const level = getStudentLevel(grandTotal);

  const now = new Date();
  const dateStr = now.toLocaleDateString("ar-SA");
  const timeStr = now.toLocaleTimeString("ar-SA");

  // المحتوى المراد طباعته
  const printContent = `
  <html dir="rtl">
  <head>
    <meta charset="UTF-8">
    <title>طباعة النتائج</title>
    <style>
      body {
        font-family: 'Baloo Bhaijaan 2', sans-serif;
        padding: 20px;
        direction: rtl;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
        font-size: 15px;
      }
      table, th, td {
        border: 1px solid #000;
      }
      th {
        background: #e5e5e5;
        padding: 8px;
      }
      td {
        padding: 8px;
        text-align: center;
      }
      h2, p {
        text-align: center;
        margin: 0;
        padding: 0;
      }
      .notes {
        font-size: 13px;
        margin-top: 10px;
        line-height: 1.6;
      }
    </style>
  </head>
  <body>

    <h2>تقرير نتائج الطالب</h2>
    <p>تاريخ الطباعة: ${dateStr} - ${timeStr}</p>

    <table>
      <tr><th>نوع التقييم</th><th>الدرجة الكاملة</th><th>درجة الطالب</th></tr>
      <tr><td>العرض الشفوي</td><td>10</td><td>${normalizeScore(st.oral)}</td></tr>
      <tr><td>الواجب المنزلي</td><td>5</td><td>${normalizeScore(st.homework)}</td></tr>
      <tr><td>التسميع / الاستماع</td><td>5</td><td>${normalizeScore(st.listening)}</td></tr>
      <tr><td>الاختبار القصير الأول</td><td>15</td><td>${normalizeScore(st.exam1)}</td></tr>
      <tr><td>الاختبار القصير الثاني</td><td>15</td><td>${normalizeScore(st.exam2)}</td></tr>
      <tr><td>التعبير الكتابي</td><td>10</td><td>${normalizeScore(st.writing)}</td></tr>
      <tr><td>مجموع أعمال الطالب</td><td>60</td><td>${normalizeScore(st.total)}</td></tr>
      <tr><td>الاختبار النهائي</td><td>40</td><td>${normalizeScore(st.final)}</td></tr>
      <tr><td><b>المجموع الكلي</b></td><td>100</td><td><b>${grandTotal}</b></td></tr>
      <tr><td><b>مستوى الطالب</b></td><td colspan="2"><b>${level}</b></td></tr>
    </table>

    <div class="notes">
      <p>الرمز "—" يشير إلى أن الدرجة لم تُسجَّل بعد، بينما (0) تعني أن الطالب حصل على صفر فعلياً.</p>
      <p>الدرجات ليست نهائية وإنما وضعت للاستعلام فقط.</p>
    </div>

    <br><br>
    <div style="display:flex; justify-content:space-between;">
      <p>توقيع ولي الأمر: ___________________</p>
      <p>توقيع المعلم: ___________________</p>
    </div>
  </body>
  </html>`;
  // فتح نافذة جديدة للطباعة (الضمان الوحيد للهاتف)
  const printWin = window.open("", "_blank");
  printWin.document.write(printContent);
  printWin.document.close();

  // إعطاء الهاتف/المتصفح وقتًا لتحميل الصفحة ثم الطباعة
  setTimeout(() => {
    printWin.print();
    printWin.close();
  }, 500);
}
      loadData();
    });
  </script>
</body>
</html>

