<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نظام نتائج الطلاب - الأستاذ خليل البلوشي</title>

<link href="https://fonts.googleapis.com/css2?family=Baloo+Bhaijaan+2:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* -------------------------
   تصميم Jameedlo – حديث جداً
-------------------------- */

:root {
  --primary: #5b73ff;
  --primary-dark: #465bdb;
  --accent: #ff7bd8;
  --bg: #f5f7fa;
  --card: #ffffff;
  --radius: 20px;
  --shadow: 0 10px 35px rgba(0,0,0,0.10);
  --shadow-hover: 0 14px 45px rgba(0,0,0,0.18);
  --text: #1d1d1f;
  --muted: #7b7b83;
}

/* Reset */
* {margin:0;padding:0;box-sizing:border-box;}

/* Body */
body{
  font-family:'Baloo Bhaijaan 2', sans-serif;
  background: var(--bg);
  color: var(--text);
  padding:20px;
  line-height:1.7;
}

/* Container */
.container{
  max-width:1150px;
  margin:auto;
}

/* Header */
header{
  text-align:center;
  margin-bottom:30px;
}

.logo{
  width:85px;
  height:85px;
  margin:auto;
  border-radius:50%;
  background:linear-gradient(135deg,#5b73ff,#ff7bd8);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:34px;
  color:white;
  box-shadow:var(--shadow);
}

h1{
  font-size:34px;
  margin-top:10px;
  background:linear-gradient(135deg,#5b73ff,#ff7bd8);
  -webkit-background-clip:text;
  color:transparent;
}

p.subtitle{
  color:var(--muted);
  margin-top:5px;
  font-size:18px;
}

/* Cards */
.card{
  background:var(--card);
  padding:30px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  transition:.3s;
}

.card:hover{box-shadow:var(--shadow-hover); transform:translateY(-3px);}

.card-header h2{
  font-size:24px;
  color:var(--primary);
  margin-bottom:20px;
}

/* Inputs */
input{
  width:100%;
  padding:16px 20px;
  border-radius:var(--radius);
  border:2px solid #e5e7eb;
  font-size:18px;
  transition:.3s;
}
input:focus{
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(91,115,255,0.20);
}

/* Buttons */
.btn-group{display:flex;gap:15px;flex-wrap:wrap;margin-top:15px;}

button{
  flex:1;
  padding:15px;
  border:none;
  border-radius:var(--radius);
  font-size:18px;
  font-weight:600;
  cursor:pointer;
  transition:.3s;
}

.btn-primary{
  background:linear-gradient(135deg,#5b73ff,#465bdb);
  color:white;
}
.btn-primary:hover{transform:translateY(-2px);}

.btn-secondary{
  background:white;
  border:2px solid var(--primary);
  color:var(--primary);
}
.btn-secondary:hover{
  background:var(--primary);
  color:white;
}

.btn-print{
  background:#00c7a5;
  color:white;
}
.btn-print:hover{
  background:#009f84;
  transform:translateY(-2px);
}

/* Quote */
.motivational-quote{
  background:linear-gradient(135deg,#ff7bd8,#5b73ff);
  color:white;
  padding:35px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  font-size:20px;
}

/* Results Box */
.results-container{
  margin-top:35px;
  background:white;
  padding:30px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}

.student-info{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:15px 20px;
  border-radius:var(--radius);
  background:linear-gradient(135deg,#5b73ff,#ff7bd8);
  color:white;
  margin-bottom:25px;
}

.student-name{display:none !important;} /* إخفاء الاسم النهائي */
.student-total{font-size:32px; font-weight:700;}

/* Stats */
.stats-container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  margin-bottom:30px;
}

.stat-card{
  background:white;
  border-radius:var(--radius);
  padding:22px;
  text-align:center;
  box-shadow:var(--shadow);
}

.stat-value{
  font-size:30px;
  font-weight:700;
  margin-top:10px;
  color:var(--primary);
}

/* Table */
.results-table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}

.results-table th{
  background:#f1f3f5;
  padding:15px;
  font-size:18px;
}

.results-table td{
  padding:15px;
  border-bottom:1px solid #eee;
  text-align:center;
  font-size:17px;
}

.max-score{background:#fff8dc;}
.final-row{background:#eaf4ff;}
.grand-total-row{background:#d9e4ff;font-weight:bold;}
.level-row{background:#ffe0f3;font-weight:bold;}

/* Note */
.note{
  background:#fff3cd;
  border:1px solid #ffe6a1;
  padding:15px;
  border-radius:var(--radius);
  margin-top:20px;
}

footer{text-align:center;color:#777;margin-top:30px;font-size:16px;}

/* Print */
@media print{
  body *{visibility:hidden;}
  #printSection, #printSection *{visibility:visible;}
  #printSection{position:absolute;top:0;left:0;width:100%;}
  button, input, header, .motivational-quote{display:none;}
}
</style>
</head>

<body>

<div class="container">

<header>
  <div class="logo"><i class="fas fa-graduation-cap"></i></div>
  <h1>نظام نتائج الطلاب</h1>
  <p class="subtitle">تابع درجاتك بكل سهولة</p>
</header>

<div class="card">
  <div class="card-header"><h2><i class="fas fa-search"></i> استعلام النتائج</h2></div>

  <input id="studentId" type="text" placeholder="أدخل رقم الطالب" onkeypress="if(event.key==='Enter') checkResult()">

  <div class="btn-group">
    <button class="btn-primary" onclick="checkResult()">عرض النتائج</button>
    <button class="btn-secondary" onclick="loadData()">تحديث البيانات</button>
    <button class="btn-print" id="printBtn" style="display:none;" onclick="printTable()">طباعة</button>
  </div>
</div>

<div class="motivational-quote">
  ✨ أنتم أبطال الكلمات وروّاد التعبير… حافظوا على تميزكم! ✨
</div>

<div id="result"></div>
<div id="printSection" class="print-section" style="display:none;"></div>

<footer>© 2025 — إعداد الأستاذ خليل البلوشي</footer>

</div>

<script>
let results = {};
let currentStudentData = null;

/* -1 → —  */
function normalizeScore(v){
  if(v === -1 || v === "-1") return "—";
  return v ?? 0;
}

/* حساب المجموع الصحيح */
function scoreForCalc(v){
  if(v === -1 || v === "-1") return 0;
  return parseFloat(v) || 0;
}

/* تحميل البيانات */
async function loadData(){
  document.getElementById("result").innerHTML =
    '<div class="note">جاري جلب البيانات…</div>';

  const URL =
   "https://docs.google.com/spreadsheets/d/1bY6sJ2CaLy7olcCpmX6V7HMuoGZIC6G9VcPWpk0eFGw/gviz/tq?tqx=out:json";

  try{
    const res = await fetch(URL);
    const txt = await res.text();

    const json = JSON.parse(
      txt.replace('/*O_o*/','')
         .replace('google.visualization.Query.setResponse(','')
         .replace(');','')
    );

    results = {};
    const rows = json.table.rows;

    rows.forEach(r=>{
      const c = r.c;
      if(!c[0] || !c[0].v) return;

      const id = c[0].v.toString();
      const oral = c[2]?.v ?? 0;
      const homework = c[3]?.v ?? 0;
      const listening = c[4]?.v ?? 0;
      const exam1 = c[5]?.v ?? 0;
      const exam2 = c[6]?.v ?? 0;
      const writing = c[7]?.v ?? 0;

      const total =
        scoreForCalc(oral)+scoreForCalc(homework)+scoreForCalc(listening)+
        scoreForCalc(exam1)+scoreForCalc(exam2)+scoreForCalc(writing);

      results[id] = {
        name: c[1]?.v ?? "—",
        oral, homework, listening, exam1, exam2, writing,
        total,
        final: c[9]?.v ?? 0
      };
    });

    document.getElementById("result").innerHTML =
      '<div class="note" style="background:#d1ffd8;">تم تحديث البيانات</div>';

  }catch(e){
    document.getElementById("result").innerHTML =
      '<div class="note" style="background:#ffd7d7;">خطأ في تحميل البيانات</div>';
  }
}

/* مستوى الطالب */
function getLevel(s){
  if(s >= 90) return "ممتاز (A)";
  if(s >= 80) return "جيد جداً (B)";
  if(s >= 65) return "جيد (C)";
  if(s >= 50) return "مقبول (D)";
  return "يحتاج إلى دعم (F)";
}

/* عرض النتيجة */
function checkResult(){
  const id = document.getElementById("studentId").value.trim();
  const box = document.getElementById("result");

  if(!id){
    box.innerHTML='<div class="note">أدخل رقم الطالب</div>';
    return;
  }

  if(!results[id]){
    box.innerHTML='<div class="note" style="background:#ffd7d7;">الرقم غير موجود</div>';
    return;
  }

  const st = results[id];
  currentStudentData = st;

  const g = scoreForCalc(st.total) + scoreForCalc(st.final);
  const level = getLevel(g);

  box.innerHTML = `
  <div class="results-container">

    <div class="student-info">
      <div class="student-name"></div>
      <div class="student-total">${g}/100</div>
    </div>

    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-value">${normalizeScore(st.total)}/60</div>
        <div>أعمال الطالب</div>
      </div>

      <div class="stat-card">
        <div class="stat-value">${normalizeScore(st.final)}/40</div>
        <div>الاختبار النهائي</div>
      </div>

      <div class="stat-card">
        <div class="stat-value">${g}/100</div>
        <div>المجموع الكلي</div>
      </div>

      <div class="stat-card">
        <div class="stat-value">${level}</div>
        <div>المستوى</div>
      </div>
    </div>

    <table class="results-table">
      <tr><th>التقييم</th><th>الكامل</th><th>درجة الطالب</th></tr>
      <tr><td>العرض الشفوي</td><td>10</td><td>${normalizeScore(st.oral)}</td></tr>
      <tr><td>الواجب</td><td>5</td><td>${normalizeScore(st.homework)}</td></tr>
      <tr><td>التسميع</td><td>5</td><td>${normalizeScore(st.listening)}</td></tr>
      <tr><td>القصير 1</td><td>15</td><td>${normalizeScore(st.exam1)}</td></tr>
      <tr><td>القصير 2</td><td>15</td><td>${normalizeScore(st.exam2)}</td></tr>
      <tr><td>التعبير</td><td>10</td><td>${normalizeScore(st.writing)}</td></tr>

      <tr class="max-score">
        <td>مجموع الأعمال</td><td>60</td><td>${normalizeScore(st.total)}</td>
      </tr>

      <tr class="final-row">
        <td>النهائي</td><td>40</td><td>${normalizeScore(st.final)}</td>
      </tr>

      <tr class="grand-total-row">
        <td>المجموع</td><td>100</td><td>${g}</td>
      </tr>

      <tr class="level-row">
        <td>المستوى</td><td colspan="2">${level}</td>
      </tr>
    </table>

    <div class="note">
      <strong>ملاحظة:</strong> — تعني أن الدرجة لم تُسجّل بعد.
    </div>

  </div>
  `;

  document.getElementById("printBtn").style.display="flex";
}

/* الطباعة */
function printTable(){
  if(!currentStudentData) return;

  const st = currentStudentData;
  const g = scoreForCalc(st.total) + scoreForCalc(st.final);
  const level = getLevel(g);

  const p = document.getElementById("printSection");

  p.innerHTML = `
  <h2 style="text-align:center;margin-bottom:15px;">نتائج الطالب</h2>

  <table class="print-table" style="width:100%;font-size:18px;border-collapse:collapse;">
    <tr><th>التقييم</th><th>الكامل</th><th>درجة الطالب</th></tr>
    <tr><td>العرض الشفوي</td><td>10</td><td>${normalizeScore(st.oral)}</td></tr>
    <tr><td>الواجب</td><td>5</td><td>${normalizeScore(st.homework)}</td></tr>
    <tr><td>التسميع</td><td>5</td><td>${normalizeScore(st.listening)}</td></tr>
    <tr><td>القصير 1</td><td>15</td><td>${normalizeScore(st.exam1)}</td></tr>
    <tr><td>القصير 2</td><td>15</td><td>${normalizeScore(st.exam2)}</td></tr>
    <tr><td>التعبير</td><td>10</td><td>${normalizeScore(st.writing)}</td></tr>
    <tr><td>مجموع الأعمال</td><td>60</td><td>${normalizeScore(st.total)}</td></tr>
    <tr><td>النهائي</td><td>40</td><td>${normalizeScore(st.final)}</td></tr>
    <tr><td><b>المجموع</b></td><td>100</td><td><b>${g}</b></td></tr>
    <tr><td><b>المستوى</b></td><td colspan="2"><b>${level}</b></td></tr>
  </table>
  `;

  p.style.display="block";
  window.print();
  p.style.display="none";
}

/* تحميل تلقائي */
window.onload = loadData;
</script>

</body>
</html>
